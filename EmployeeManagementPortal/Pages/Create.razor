@page "/create"
@using EmployeeManagementPortal.Models;
@using System.ComponentModel.DataAnnotations;
@inject NavigationManager Navigation
@inject HttpClient Http

<h3>Create a new employee</h3>

@if (!string.IsNullOrEmpty(message))
{
    <div class="@messageClass">@message</div>
}
@if (employee == null)
{
<p><em>Loading...</em></p>
}
else
{
<EditForm Model="employee" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div>
        <label for="name">Name:</label>
        <InputText id="name" @bind-Value="employee.Name" />
    </div>
    <div>
        <label for="position">Position:</label>
        <InputText id="position" @bind-Value="employee.Position" />
    </div>
    <div>
        <label for="department">Department:</label>
        <InputText id="department" @bind-Value="employee.Department" />
    </div>
    <div>
        <label for="salary">Salary:</label>
        <InputNumber id="salary" @bind-Value="employee.Salary" />
        <button type="submit">Save</button>
    </div>
</EditForm>

    <button @onclick="EmployeeManagement">Back to Employee List</button>

}
@code {

    [Parameter]

    public int Id { get; set; }

    private Employee? employee = null;

    private string? message = null;
    private string messageClass = "";

    protected override void OnInitialized()
    {
        employee = new Employee
        {
            Name = "",
            Position = "",
            Department = ""
        };
    }

    public async Task HandleValidSubmit()
    {
        try
        {

            var response = await Http.PostAsJsonAsync("https://localhost:7109/api/Employee/Add", employee);

            if (response.IsSuccessStatusCode)
            {
                message = "Employee created successfully!";
                messageClass = "alert alert-success"; 
                StateHasChanged();
                await Task.Delay(2500);
                Navigation.NavigateTo("/EmployeeManagement");
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                message = $"Failed to add employee: {error}";
                messageClass = "alert alert-danger";
                Console.WriteLine($"API Error: {response.StatusCode} - {error}");
            }
        }
        catch (HttpRequestException)
        {
            message = "Network error. Please check your connection.";
            messageClass = "alert alert-danger";
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Exception: {ex.Message}");

        }
    }

    private void EmployeeManagement()
    {
        Navigation.NavigateTo("/EmployeeManagement");
    }
}


